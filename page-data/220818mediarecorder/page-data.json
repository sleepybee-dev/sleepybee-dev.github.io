{"componentChunkName":"component---src-templates-post-jsx","path":"/220818mediarecorder/","result":{"data":{"site":{"siteMetadata":{"title":"sleepybee-dev-log"}},"markdownRemark":{"id":"8ee19a1b-baa8-5cdd-ab14-8508b81538e1","excerpt":"저장소 액세스 정책 변경 Android 10 이상을 타겟팅하는 기기부터 외부 저장소 루트는 아예 사용할 수가 없고 몇 가지 허용된 공간만 사용 가능합니다. 또, 사용 가능한 외부 저장소에 액세스할 경우에 SAF나 MediaStore를 사용하도록 강제되었습니다.  $card 이 저장소 정책이 적용된지는 한참 됐지만 MediaRecorder에서 약간 헤매게 …","html":"<h2 id=\"저장소-액세스-정책-변경\" style=\"position:relative;\"><a href=\"#%EC%A0%80%EC%9E%A5%EC%86%8C-%EC%95%A1%EC%84%B8%EC%8A%A4-%EC%A0%95%EC%B1%85-%EB%B3%80%EA%B2%BD\" aria-label=\"저장소 액세스 정책 변경 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>저장소 액세스 정책 변경</h2>\n<p>Android 10 이상을 타겟팅하는 기기부터 외부 저장소 루트는 아예 사용할 수가 없고 몇 가지 허용된 공간만 사용 가능합니다. 또, 사용 가능한 외부 저장소에 액세스할 경우에 SAF나 MediaStore를 사용하도록 강제되었습니다.<br>\n<a href=\"https://developer.android.com/training/data-storage/shared/media?hl=ko\">$card</a></p>\n<p>이 저장소 정책이 적용된지는 한참 됐지만 MediaRecorder에서 약간 헤매게 됐는데 솔루션이 있는 웹페이지가 없길래 정리해 둡니다.</p>\n<h2 id=\"MediaRecorder\" style=\"position:relative;\"><a href=\"#MediaRecorder\" aria-label=\"MediaRecorder permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>MediaRecorder</h2>\n<p><div>\n      <a target='_blank' rel='noopener noreferrer' href='https://github.com' class='preview-notion-container'>\n        <div class='preview-notion-wrapper'>\n          <div class='preview-notion-title'>Not Found Site</div>\n          <div class='preview-notion-description'>Cannot find site or meta tag and title.</div>\n          <div class='preview-notion-url'>\n            <img class='preview-notion-favicon' src='data:image/png;base64,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' alt='Not Found Site-favicon'>\n            <div class='preview-notion-link'>https://github.com</div>\n          </div>\n        </div>\n        <div class='preview-notion-image-wrapper'>\n          <img class='preview-notion-image' alt='Not Found Site-image' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABWCAMAAAAHZWO6AAAAKlBMVEXy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7///8W37AjAAACRklEQVRo3u2Za3bEIAiFg8+ouP/t9kem0yQKomXanp5hAX4mXC6i2/YOYUDKurHfAAarbuTfAJSkFdgHRLWMpjfgDfg5ALgQgzevAphYaq21YrIvAbjyrHuMoA9wF3eK6gBTruYVtAH7zR2L0QXYxr6DLiC0Bg+qgNQA0GgCoAOwr/4CXcDeAIrqL9p8A0jMmQfmAfc6q9XTgJBgvtCiXKUO6w7zVpGvKXbk+rY0ZSgyO3v+SUjX8bGT6wZkdm2+pFroBMBDb8XONxzwCWutmAOj0GeuslnpycY5ZzkT8l+meEq0XtO/dKWoD7hWC3ptwN0Sn4lWAkBjWJ+JVgK0Tak+PEMH4HpDUdQD2NKbnI5EawBuXnU1rTUABMv21FNjWgOEs2VHer5MsAZweHIDz029O6wAjpxGRkCnM9oC4JHTQySm8EM4zs/Jz5yi654rZZN+FLj+cXrxqAw4L5ig7xLfAVxzukPP574DuOc0soU2D2jWQi9Q0gRg7/vNQEpyQCD8ZiAlMaBftGMpSQG2UH4zkJL0XJRJvxlISXhXQe9xJCUZIHKOxktJBOB1wktJAhiZZgLmIyXH9zzyG05KY8DQbT6llBcBUXB/zEhpCAhVEuioYh8BnPCynJTSAGCL9JadkhIPgFzFQUiJBYwb4lhKLCDMrE9IiQP4ydcQtB1VMAB5gjkp0QCT63R0pEQCJA4hkRIJiHUpGilRALv68GS2bTMhHlG4X7T4kvg3HihAKwgAFq3AX3rL1AXc1AJx142w/Zf4AH4Xp03JwAN4AAAAAElFTkSuQmCC'>\n        </div>\n      </a>\n    </div></p>\n<p>시시콜콜한 것들은 도큐먼트에 잘 나와 있습니다.</p>\n<h2 id=\"외부저장소에-저장하기\" style=\"position:relative;\"><a href=\"#%EC%99%B8%EB%B6%80%EC%A0%80%EC%9E%A5%EC%86%8C%EC%97%90-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0\" aria-label=\"외부저장소에 저장하기 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>외부저장소에 저장하기</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\nrecorder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MediaRecorder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \nrecorder<span class=\"token punctuation\">.</span><span class=\"token function\">setAudioSource</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaRecorder<span class=\"token punctuation\">.</span>AudioSource</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MIC</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \nrecorder<span class=\"token punctuation\">.</span><span class=\"token function\">setOutputFormat</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaRecorder<span class=\"token punctuation\">.</span>OutputFormat</span><span class=\"token punctuation\">.</span><span class=\"token constant\">THREE_GPP</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \nrecorder<span class=\"token punctuation\">.</span><span class=\"token function\">setOutputFile</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>여기서 <code class=\"language-text\">setOutputFile()</code>의 fileName은 저장하고자 하는 파일명의 full path만 사용하면 됐었습니다.\n이 함수는 내부 저장소(data/data/{app_name})에서는 고대로 사용할 수 있습니다.\n하지만 MediaStore로 접근해야 하는 외부 저장소를 사용할 때에는 더이상 String으로된 path로 접근할 수가 없습니다.</p>\n<p>그렇다면 outputFile의 Path를 어떻게 지정할 수 있을까?</p>\n<p><code class=\"language-text\">setOutputFile()</code>중에는 FileDescriptor를 파라미터로 갖는 것이 있습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/7b4cd838bca4f3a7d1188a893f375028/dac1b/mediarecorder.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 31.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQElEQVR42mWQW0/CQBCF+Ue9QGlpaXd7oYXaFk15ABKMRirGkKCJSLSKDz4QEiPyQNRfexxKICQ+fDvnZDNnZ7YkSRJMi8NrBGDcIc3AHQ+GoYMbKhzXh+02wGwHmqZCluUCURQgiSK2/ceUtodhWocmz28W2qagoBWhEYSFd7wALj3KuQdTt1BVVFTKCgQKPaakKBW4no8wTtAMIyRnKaI4QtikUGbA5nVYdQ3MpInJM6sGpmvgug5DLUNVBNRUuUCr0oT7FfZIhBVlcPtzON2nArf3fMDp5eDdnO7zQp9cvqOdLZDeLJEMF7uVjxFECYPBBKOXDSZvvxi/fmM8/8FtvsFw+omrhxXO71fIZl/IHtcYzda4npGffuDibvk/UKR/SFsM/Y5HBIR/qGnEkMYMnYRT3dFp20U9DU0kQQ1/pZrd0zgwP2cAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset='/static/7b4cd838bca4f3a7d1188a893f375028/33073/mediarecorder.webp 170w,\n/static/7b4cd838bca4f3a7d1188a893f375028/719ab/mediarecorder.webp 340w,\n/static/7b4cd838bca4f3a7d1188a893f375028/4c79d/mediarecorder.webp 680w,\n/static/7b4cd838bca4f3a7d1188a893f375028/a5efa/mediarecorder.webp 703w' sizes='(max-width: 680px) 100vw, 680px' type='image/webp'>\n          <source srcset='/static/7b4cd838bca4f3a7d1188a893f375028/e7570/mediarecorder.png 170w,\n/static/7b4cd838bca4f3a7d1188a893f375028/f46e7/mediarecorder.png 340w,\n/static/7b4cd838bca4f3a7d1188a893f375028/ca1dc/mediarecorder.png 680w,\n/static/7b4cd838bca4f3a7d1188a893f375028/dac1b/mediarecorder.png 703w' sizes='(max-width: 680px) 100vw, 680px' type='image/png'>\n          <img class='gatsby-resp-image-image' src='/static/7b4cd838bca4f3a7d1188a893f375028/ca1dc/mediarecorder.png' alt='mediarecorder' title='' loading='lazy' decoding='async' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;'>\n        </picture>\n  </a>\n    </span></p>\n<p>이렇게 FileDescriptor를 얻으면 되겠구나!</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">FileDescriptor</span> <span class=\"token function\">getFileDescriptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">ContentValues</span> values <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ContentValues</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    values<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaStore<span class=\"token punctuation\">.</span>Video<span class=\"token punctuation\">.</span>Media</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DISPLAY_NAME</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"filename.MP4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    values<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaStore<span class=\"token punctuation\">.</span>Video<span class=\"token punctuation\">.</span>Media</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MIME_TYPE</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"video/*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">ContentResolver</span> resolver <span class=\"token operator\">=</span> <span class=\"token function\">getContentResolver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Uri</span> item <span class=\"token operator\">=</span> contentResolver<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaStore<span class=\"token punctuation\">.</span>Video<span class=\"token punctuation\">.</span>Media</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXTERNAL_CONTENT_URI</span><span class=\"token punctuation\">,</span> values<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">ParcelFileDescriptor</span> fileDescriptor <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\n        fileDescriptor <span class=\"token operator\">=</span> resolver<span class=\"token punctuation\">.</span><span class=\"token function\">openFileDescriptor</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> <span class=\"token string\">\"w\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> fileDescriptor<span class=\"token punctuation\">.</span><span class=\"token function\">getFileDescriptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FileNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>안됩니다.</p>\n<p>내부저장소는 full path만 넣으면 파일이 미리 만들어져 있지 않아도 그 위치에 그 파일명으로 write가 되었던 반면, 이렇게 할 때엔 내가 임시 파일을 생성해 두어야 합니다.  </p>\n<p>여기서 기존 코드랑 꼬였어서 조금 헤맸습니다.</p>\n<ul>\n<li>정상 예제</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">FileDescriptor</span> <span class=\"token function\">getFileDescriptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">ContentValues</span> values <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ContentValues</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    values<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaStore<span class=\"token punctuation\">.</span>Video<span class=\"token punctuation\">.</span>Media</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DISPLAY_NAME</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"filename.MP4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    values<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaStore<span class=\"token punctuation\">.</span>Video<span class=\"token punctuation\">.</span>Media</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MIME_TYPE</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"video/*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Build</span><span class=\"token punctuation\">.</span><span class=\"token constant\">VERSION</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SDK_INT</span> <span class=\"token operator\">>=</span> <span class=\"token class-name\">Build<span class=\"token punctuation\">.</span>VERSION_CODES<span class=\"token punctuation\">.</span>Q</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">// 해당 파일을 다른 앱에서 접근하는 것을 막는 플래그.</span>\n\n        values<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaStore<span class=\"token punctuation\">.</span>Video<span class=\"token punctuation\">.</span>Media</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IS_PENDING</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">ContentResolver</span> resolver <span class=\"token operator\">=</span> <span class=\"token function\">getContentResolver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Uri</span> item <span class=\"token operator\">=</span> contentResolver<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaStore<span class=\"token punctuation\">.</span>Video<span class=\"token punctuation\">.</span>Media</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXTERNAL_CONTENT_URI</span><span class=\"token punctuation\">,</span> values<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">ParcelFileDescriptor</span> fileDescriptor <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">// file write 추가</span>\n\n        fileDescriptor <span class=\"token operator\">=</span> resolver<span class=\"token punctuation\">.</span><span class=\"token function\">openFileDescriptor</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> <span class=\"token string\">\"w\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fileDescriptor <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">// 빈 파일 생성</span>\n\n        <span class=\"token class-name\">String</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> strToByte <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">FileOutputStream</span> fos <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span>fileDescriptor<span class=\"token punctuation\">.</span><span class=\"token function\">getFileDescriptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        fos<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>strToByte<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        fos<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Build</span><span class=\"token punctuation\">.</span><span class=\"token constant\">VERSION</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SDK_INT</span> <span class=\"token operator\">>=</span> <span class=\"token class-name\">Build<span class=\"token punctuation\">.</span>VERSION_CODES<span class=\"token punctuation\">.</span>Q</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n            values<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// 해당 파일을 다른 앱에서 접근하는 것을 다시 허용.</span>\n\n            values<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaStore<span class=\"token punctuation\">.</span>Images<span class=\"token punctuation\">.</span>Media</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IS_PENDING</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            contentResolver<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> values<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> fileDescriptor<span class=\"token punctuation\">.</span><span class=\"token function\">getFileDescriptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FileNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 Recording이 정상적으로 되는 것을 확인할 수 있습니다.</p>\n<p>서치하다가 못 찾고 궁리해낸 방법이라 제대로 된 솔루션이 따로 있을 수 있습니다.</p>\n<p>지적은 언제나 환영.</p>","frontmatter":{"title":"[해결] MediaRecorder에서 저장소 정책 변경 적용","date":"August 18, 2022","update":null,"tags":["SLtackOverFlow","Android"],"series":null},"fields":{"slug":"/220818mediarecorder/","readingTime":{"minutes":4.035}}},"seriesList":{"edges":[{"node":{"id":"33662c2c-29fd-5961-9f17-56ef6f5523f0","fields":{"slug":"/201006ptube/"},"frontmatter":{"title":"📼비공개 유튜브 채널 앱, 피튜브Ptube"}}},{"node":{"id":"d66b9a74-ac07-5ed6-a85c-daaa3f4c6d96","fields":{"slug":"/201202picshelf/"},"frontmatter":{"title":"🖼️사진 위젯 앱, 픽셀프Picshelf"}}},{"node":{"id":"ca8bfe95-74f3-54b5-92f8-b2e0ee7ec151","fields":{"slug":"/220327diamonddialfab/"},"frontmatter":{"title":"💠다이아몬드 다이얼 FAB 라이브러리"}}},{"node":{"id":"334b30d0-0086-59f7-84c2-638ec6aca270","fields":{"slug":"/220807obsidianblog/"},"frontmatter":{"title":"옵시디언 블로그 만들기"}}},{"node":{"id":"8f0c6fb5-a592-511e-bf32-3c5daf095f85","fields":{"slug":"/220811plibula/"},"frontmatter":{"title":"🎤플레이리스트를 노래방 번호로 바꿔주는 앱, 플리불러"}}},{"node":{"id":"8ee19a1b-baa8-5cdd-ab14-8508b81538e1","fields":{"slug":"/220818mediarecorder/"},"frontmatter":{"title":"[해결] MediaRecorder에서 저장소 정책 변경 적용"}}},{"node":{"id":"4b039cfb-43ba-5c40-b675-a5aa507a5dab","fields":{"slug":"/220819zolaseo/"},"frontmatter":{"title":"Zola 블로그 검색 노출 작업 (SEO)"}}},{"node":{"id":"5870c218-f18f-5670-8d49-731d9032198b","fields":{"slug":"/220902getxtwitter/"},"frontmatter":{"title":"시간을 되돌려 GetX가 만들어지는 걸 막고 싶다"}}},{"node":{"id":"f5d475c2-c0c2-57f0-84c5-a90fb5ba057f","fields":{"slug":"/221014slide/"},"frontmatter":{"title":"(슬라이드) Shallow Dive to Obsidian"}}},{"node":{"id":"7d289b78-cbf8-5b98-a156-6a5db6ca5ff7","fields":{"slug":"/221125boostcorse/"},"frontmatter":{"title":"데이터사이언스 부스트코스 회고"}}},{"node":{"id":"56804d93-fb54-5957-975b-719a27e9ef46","fields":{"slug":"/221217compose/"},"frontmatter":{"title":"Compose Camp 회고"}}},{"node":{"id":"cc33197a-f69a-54d4-9181-97b8c08c1160","fields":{"slug":"/230127wewish/"},"frontmatter":{"title":"🎁위시리스트 공유하는 앱, 위위시wewish"}}},{"node":{"id":"f8bb70d9-bfcb-5fa0-ac2f-d9cf463e770c","fields":{"slug":"/230207fluttersongdo/"},"frontmatter":{"title":"Flutter Songdo 스터디 회고"}}}]},"previous":{"fields":{"slug":"/220811plibula/"},"frontmatter":{"title":"🎤플레이리스트를 노래방 번호로 바꿔주는 앱, 플리불러"}},"next":{"fields":{"slug":"/220819zolaseo/"},"frontmatter":{"title":"Zola 블로그 검색 노출 작업 (SEO)"}}},"pageContext":{"id":"8ee19a1b-baa8-5cdd-ab14-8508b81538e1","series":null,"previousPostId":"8f0c6fb5-a592-511e-bf32-3c5daf095f85","nextPostId":"4b039cfb-43ba-5c40-b675-a5aa507a5dab"}},"staticQueryHashes":[],"slicesMap":{}}